"use strict";!function(i,a){var n,h,g,e,l,s={},d=!1,f={white:"#ffffff",black:"#000000",overlay:"rgba(0, 0, 0, 0.6)"};function u(){if(h.clearRect(0,0,n.width,n.height),g!==a){var e=s;if(h.drawImage(g,0,0,e.width,e.height),d){h.save(),h.fillStyle=f.overlay,h.beginPath(),h.moveTo(0,0),h.lineTo(l.x,l.y),h.lineTo(l.x+l.width,l.y),h.lineTo(n.width,0),h.moveTo(n.width,0),h.lineTo(l.x+l.width,l.y),h.lineTo(l.x+l.width,l.y+l.height),h.lineTo(n.width,n.height),h.moveTo(n.width,n.height),h.lineTo(l.x+l.width,l.y+l.height),h.lineTo(l.x,l.y+l.height),h.lineTo(0,n.height),h.moveTo(0,n.height),h.lineTo(l.x,l.y+l.height),h.lineTo(l.x,l.y),h.lineTo(0,0),h.fill(),h.restore();var t=l.x+l.width-5,i=l.y+l.height-5,r=l.resizerSide,o=l.resizerSide;h.save(),h.fillStyle=f.black,h.strokeStyle=f.white,h.fillRect(t,i,r,o),h.strokeRect(t,i,r,o),h.restore()}}}function r(e){var t=n.getBoundingClientRect();return{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}}function o(e){var t=e.x,i=e.y;return{x:t-window.scrollX,y:i-window.scrollY}}function y(e,t){return e>l.x&&e<l.x+l.width&&t>l.y&&t<l.y+l.height}function w(e,t){return e>l.x+l.width-l.resizerSide&&e<l.x+l.width+l.resizerSide&&t>l.y+l.height-l.resizerSide&&t<l.y+l.height+l.resizerSide}var c={type:"",inProgress:!1,originalOverlayX:0,originalOverlayY:0,originalX:0,originalY:0,originalOverlayWidth:0,originalOverlayHeight:0};function v(e){var t=e.x,i=e.y;y(t,i)&&(c.type="moveOverlay",c.inProgress=!0,c.originalOverlayX=t-l.x,c.originalOverlayY=i-l.y),w(t,i)&&(c.type="resizeOverlay",c.inProgress=!0,c.originalX=t,c.originalY=i,c.originalOverlayWidth=l.width,c.originalOverlayHeight=l.height)}function x(e){var t=e.x,i=e.y;if(w(t,i)||c.inProgress&&"resizeOverlay"===c.type?n.style.cursor="nwse-resize":y(t,i)?n.style.cursor="move":n.style.cursor="auto",c.inProgress)if("moveOverlay"===c.type){l.x=t-c.originalOverlayX,l.y=i-c.originalOverlayY;var r=n.width-l.width,o=n.height-l.height;l.x<0?l.x=0:l.x>r&&(l.x=r),l.y<0?l.y=0:l.y>o&&(l.y=o),u()}else"resizeOverlay"===c.type&&(l.width=c.originalOverlayWidth+(t-c.originalX),l.width<10&&(l.width=10),l.x+l.width>n.width&&(l.width=n.width-l.x),l.height=l.width*l.ratioXY,l.y+l.height>n.height&&(l.height=n.height-l.y,l.width=l.height/l.ratioXY),u())}function p(e){if(g===a)return!1;d||(e=!0);var t=0,i=0,r=g.width,o=g.height;if(!e){var n=s.factor;t=Math.floor(l.x/n),i=Math.floor(l.y/n),r=Math.floor(l.width/n),o=Math.floor(l.height/n),t<0&&(t=0),t>g.width&&(t=g.width),i<0&&(i=0),i>g.height&&(i=g.height),t+r>g.width&&(r=g.width-t),i+o>g.height&&(o=g.height-i)}var h=document.createElement("canvas");return h.setAttribute("width",r),h.setAttribute("height",o),h.getContext("2d").drawImage(g,t,i,r,o,0,0,r,o),h}i.showImage=function(e){d=!1,(g=new Image).onload=function(){var e,t,i;e=g.width,t=g.height,i=1,i=n.width-e<n.height-t?n.width/e:n.height/t,s={width:Math.floor(e*i),height:Math.floor(t*i),factor:i},u()},g.src=e},i.startCropping=function(){return g!==a&&((e=new Image).src=g.src,d=!0,u(),!0)},i.getCroppedImageSrc=function(){if(g){var e=p(!d).toDataURL("png");return d&&i.showImage(e),d=!1,e}return!1},i.getCroppedImageBlob=function(e){if(g){var t=p(!d).toDataURL(e||"png");return d&&i.showImage(t),d=!1,function(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),o=new Uint8Array(r),n=0;n<t.length;n++)o[n]=t.charCodeAt(n);return new Blob([o],{type:i})}(t)}return!1},i.start=function(e,t){var i;(n=e).getContext&&(h=n.getContext("2d"),l={x:50,y:50,width:100,height:100,resizerSide:10,ratioXY:1},t&&(i=t,l.ratioXY=i,l.height=Math.floor(l.width*i)),n.onmousedown=function(e){v(o(n.getMouseCoords(e)))},n.onmouseup=function(e){c.inProgress=!1},n.onmouseout=function(e){c.inProgress=!1},n.onmousemove=function(e){x(o(n.getMouseCoords(e)))},n.addEventListener("touchstart",function(e){v(r(e))}),n.addEventListener("touchmove",function(e){x(r(e))}),n.addEventListener("touchend",function(e){c.inProgress=!1}))},i.restore=function(){return e!==a&&(d=!1,i.showImage(e.src),!0)},HTMLCanvasElement.prototype.getMouseCoords=function(e){for(var t=0,i=0,r=this;t+=r.offsetLeft,i+=r.offsetTop,r=r.offsetParent;);return{x:e.pageX-t,y:e.pageY-i}}}(window.cropper=window.cropper||{});